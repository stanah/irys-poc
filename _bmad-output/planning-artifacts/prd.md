---
stepsCompleted:
  - step-01-init
  - step-02-discovery
  - step-03-success
  - step-04-journeys
  - step-05-domain
  - step-06-innovation
  - step-07-project-type
  - step-08-scoping
  - step-09-functional
  - step-10-nonfunctional
  - step-11-polish
  - step-12-complete
classification:
  projectType: 'blockchain_web3 + web_app'
  domain: 'media_entertainment'
  domainSubconcerns: 'fintech (P2P tipping, revenue split, 資金決済法)'
  complexity: 'high'
  projectContext: 'brownfield'
inputDocuments:
  - '_bmad-output/planning-artifacts/product-brief-irys-poc-2026-02-02.md'
  - '_bmad-output/planning-artifacts/research/market-decentralized-video-monetization-research-2026-02-01.md'
  - '_bmad-output/planning-artifacts/research/technical-irys-livepeer-lit-architecture-research-2026-02-02.md'
  - '_bmad-output/brainstorming/brainstorming-session-2026-02-01.md'
  - 'docs/index.md'
  - 'docs/project-overview.md'
  - 'docs/architecture.md'
  - 'docs/source-tree-analysis.md'
  - 'docs/development-guide.md'
  - 'docs/component-inventory.md'
  - 'docs/api-contracts.md'
  - 'docs/research/livepeer-theta-comparison.md'
documentCounts:
  briefs: 1
  research: 2
  brainstorming: 1
  projectDocs: 8
workflowType: 'prd'
date: '2026-02-03'
author: 'stanah'
---

# Product Requirements Document - irys-poc

**Author:** stanah
**Date:** 2026-02-03

## Executive Summary

### Vision

**プラットフォームに依存しない、クリエイターのための動画配信基盤。** 中央集権的なインフラを所有せず、専門の分散型プロトコルを水平統合する"薄い統合レイヤー"として機能する。クリエイターは特定プラットフォームの収益モデルや規約変更に左右されず、自らのコンテンツと収益を完全にコントロールできる。

### Product Differentiator

既存の動画プラットフォーム（YouTube、Twitch等）は、インフラの所有と引き換えにコンテンツ・収益・ユーザーデータを支配する。本プロジェクトは各機能レイヤーを専門の分散型プロトコルに委ねることで、この構造を逆転させる：

- **Irys** — 永続分散ストレージ（コンテンツの恒久的保存）
- **Livepeer** — 分散トランスコード
- **Lit Protocol** — クリエイター主導のアクセス制御
- **Smart Contract** — 仲介なしのP2P直接送金
- **Account Abstraction** — Web3を意識させないオンボーディング

ファンからクリエイターへの送金はノンカストディアルP2Pで行われ、プラットフォームは一切資金を預からない。

### Target Users

| ユーザー | ニーズ | 提供価値 |
|---------|-------|---------|
| **ファン** | 推しクリエイターを直接支えたい | 支援が仲介なしで届く。Web3知識不要 |
| **クリエイター** | 特定プラットフォームに依存せず発信したい | コンテンツと収益の完全なコントロール。初日から収益化可能 |

### Project Context

本プロジェクトは**技術実証（PoC）** である。4プロトコル水平統合の技術的成立性と運用コストの把握が目的。ソロ開発者（stanah）が3ヶ月で実証する。

## Success Criteria

### User Success

| 成功基準 | 測定方法 | 成功の定義 |
|---------|---------|-----------|
| **投げ銭の100%到達確認（送り手体験）** | 投げ銭送信後のオンチェーントランザクション表示 | ファンが送金→クリエイターへの到達をUI上で確認できる |
| **投げ銭の100%到達確認（受け手体験）** | クリエイター側の受領通知・履歴表示 | クリエイターが受け取った投げ銭を確認できる |
| **公開動画の視聴** | アップロード→再生の全フロー完了 | 誰でも公開動画をシームレスに視聴できる |
| **限定動画の視聴** | ACC検証→復号→再生の全フロー完了 | 条件を満たすユーザーのみが限定動画を視聴できる |
| **Web2ライクなオンボーディング** | AA経由でのアカウント作成→動画視聴→投げ銭 | MetaMask未所持ユーザーがメール/SNSログインで利用開始できる |
| **オンボーディング完了ステップ数** | ステップ数計測 | **3ステップ以内**（ログイン→プロフィール確認→動画視聴開始） |

### Business Success

| 成功基準 | 測定方法 | 成功の定義 |
|---------|---------|-----------|
| **PoC技術実証（3ヶ月後）** | 全パイプラインの動作確認 | 公開・限定両パイプラインが一気通貫で動作する |
| **運用コストの把握** | 各プロトコルの実効コスト計測・記録 | 下記コスト内訳が実測値として記録されている |
| **プラットフォーム固定コスト計測** | ホスティング・ドメイン等の月間費用記録 | 月間固定コストの実額が把握できている |
| **アクティブクリエイター（12ヶ月後）** | ユニーククリエイターアドレス数 | 5人以上 |
| **月間投げ銭（12ヶ月後）** | オンチェーントランザクション数 | 月10件以上 |

**コスト内訳記録項目:**

| コスト項目 | 計測対象 | 単位 |
|-----------|---------|------|
| Irysストレージ | 永続ストレージ | $/GB |
| Livepeerトランスコード | 動画変換 | $/分 |
| Lit復号 | Naga使用量課金 | $/リクエスト |
| ホスティング | Vercel等 | $/月 |
| ドメイン | ドメイン維持 | $/年 |

### Technical Success

| 成功基準 | 測定方法 | 成功の定義 |
|---------|---------|-----------|
| **公開動画パイプライン** | E2Eテスト | アップロード→Livepeerトランスコード→Irys保存→HLS再生が正常完了 |
| **限定動画パイプライン** | E2Eテスト | アップロード→トランスコード→Lit暗号化→Irys保存→ACC検証→復号→再生が正常完了 |
| **限定動画初回再生開始時間** | パフォーマンス計測 | **目標: 3秒以内** |
| **投げ銭パイプライン** | コントラクトテスト | VideoTippingコントラクトによるP2P直接送金＋収益分配が正常動作 |
| **投げ銭確認表示時間** | パフォーマンス計測 | 送信→オンチェーン確認表示までの時間を**計測・記録** |
| **AA統合** | オンボーディングフローテスト | Alchemy Account Kit経由でメール/SNSログイン→動画視聴→投げ銭が可能 |
| **復号コスト実測** | Lit Naga使用量ログ | 限定動画1再生あたりのLit復号コストが計測・記録されている |
| **テストインフラ** | Playwrightセットアップ | E2Eテストフレームワークが稼働し、主要パイプラインのテストが自動実行可能 |

### Measurable Outcomes

**PoC完了判定（全項目を満たすこと）:**
1. 公開動画を10本以上アップロード・再生確認
2. 限定動画の暗号化→復号→再生フロー動作確認
3. AA経由のオンボーディングフロー動作確認
4. 投げ銭のオンチェーン到達確認（送り手・受け手双方のUI）
5. 各プロトコルの実効コスト（Irys, Livepeer, Lit）が記録されている
6. E2Eテストフレームワーク（Playwright）がセットアップされ、主要フローのテストが通過

## Product Scope

### 前提条件（MVPの前に完了必須）

| 条件 | 期限 | 詳細 |
|------|------|------|
| **Lit Protocol Naga移行** | 2026/2/25 | SDK v8 + Nagaネットワークでの暗号化/復号化動作確認 |

### MVP — Minimum Viable Product（P0-A + P0-B）

**P0-A: 公開動画の一気通貫**
- 公開動画アップロード（Livepeer TUS→トランスコード→Irys保存）
- 公開動画再生（Irys Gateway→HLS再生）
- 動画メタデータ（タイトル、説明、カテゴリ、アクセスタイプ）
- MetaMask接続
- タグベースフィルタリング（Irys GraphQL）

**P0-B: コアバリューの実現**
- 限定動画アップロード（トランスコード→Lit暗号化→Irys保存）
- 限定動画再生（ACC検証→復号→HLS再生）
- 投げ銭（VideoTippingコントラクトによるP2P直接送金）
- アカウントアブストラクション（Alchemy Account Kit）
- 復号コスト実測・記録

**テストインフラ**
- Playwrightセットアップ
- 主要パイプライン（公開動画、限定動画、投げ銭、AA）のE2Eテスト

**MVP完了判定:** 上記全パイプラインが動作し、Measurable Outcomesの6項目を満たした時点。

### Growth Features（Post-MVP / P1）

- HLSアダプティブビットレート（品質選択）
- 投げ銭履歴一覧（オンチェーンデータ表示）
- `@irys/query`パッケージ採用（GraphQL改善）
- Livepeer Webhook導入（ポーリング→イベント駆動）
- GraphQLエンドポイント環境変数化（Irys L1移行備え）
- クリエイターチャンネルページ

### Vision（Future / Phase 2-3）

- Revenue Split（コラボ制作向け自動収益分配）
- メンバーシップ/サブスクリプション
- AI機能（字幕・翻訳・推薦）
- ファン貢献機能（字幕投稿等）とオンチェーン記録
- AI経済圏への拡張
- DAO化（合同会社型DAO）
- IrysVM Programmable Data活用

## User Journeys

### Journey 1: ファン — 「推しを直接支えたい」

**ペルソナ: ユウキ（22歳）**
フリーランスのWebデザイナー。テック系YouTuberの熱心なファン。推しクリエイターの動画は毎回欠かさず視聴し、コメントも積極的に残す。YouTubeのSuper Chatで投げ銭したことがあるが、「30%も手数料取られるのか…」と少しモヤモヤしていた。MetaMaskは持っていないが、暗号資産には興味がある。

**Opening Scene — 推しからの告知**

ある日、ユウキがいつも見ているテック系クリエイター「TechMaster Ken」がTwitterで告知を投稿する。

> 「新しいプラットフォームでも動画配信始めました！ここなら投げ銭が100%届きます。良かったら覗いてみてください」

リンクをクリックすると、見慣れないUIのサイトが開く。「Web3？ウォレット？」と少し身構えるユウキ。

**Rising Action — 意外とスムーズなオンボーディング**

ログインボタンを押すと「Googleアカウントでログイン」の選択肢が。MetaMaskの設定は不要らしい。Googleアカウントで認証すると、数秒でプロフィール画面に。「あれ、ウォレットとか作らなくていいの？」と拍子抜けするほど簡単。

TechMaster Kenの動画を見つけてクリック。普通に再生が始まる。画質も問題なし。「これ、本当にWeb3なの？」

**Climax — 100%が届く確認の瞬間**

動画を見終えたユウキは、下にある「Tip」ボタンに気づく。「0.01 ETH」のプリセットを選択。「推しに直接届くなら、これくらい…」

送信ボタンを押すと、ローディング表示が現れる:
> ⏳ **トランザクションを処理しています...**
> ブロックチェーンに記録中です。しばらくお待ちください。

10〜30秒後、確認画面が表示される:
> ✅ **TechMaster Ken に 0.01 ETH が届きました**
> トランザクション: 0x7a8b...3f2d（Polygonscanで確認）

「え、これ本当に全額届いたの？」リンクをクリックしてPolygonscanを開く。確かに、自分のアドレスからTechMaster Kenのアドレスへ、手数料を除いた0.01 ETHがそのまま送金されている。プラットフォームの中抜きなし。

**ユウキの心の声:** 「これだ。これが欲しかったんだ。」

**Resolution — 新しい応援のカタチ**

それ以来、ユウキはTechMaster Kenの新作がこのプラットフォームに上がるたびにチェックするようになった。投げ銭の履歴を見ると、自分が「初期サポーター」として記録されている。YouTubeでは得られなかった「直接つながっている感覚」がそこにある。

---

### Journey 1b: ファン — エラーリカバリー「うまくいかない時」

**ペルソナ: ユウキ（22歳）** — Journey 1と同一人物

**シナリオA: 残高不足** ⚡ MVP必須

ユウキは0.01 ETHの投げ銭を送ろうとする。しかし、ウォレット残高が0.005 ETHしかない。

送信ボタンを押すと:
> ⚠️ **残高が不足しています**
> 必要額: 0.01 ETH + ガス代
> 現在の残高: 0.005 ETH
>
> [残高を追加する方法を見る]

リンクをクリックすると、Polygon Amoyテストネットの場合はFaucetへの案内、本番環境ではオンランプへの案内が表示される。

**シナリオB: ネットワークエラー** 📋 P1

投げ銭送信中にネットワークが切断される。

> ⚠️ **送信に失敗しました**
> ネットワーク接続を確認してください。
> トランザクションは送信されていません。残高は変わっていません。
>
> [再試行]

**シナリオC: AAログイン失敗** 📋 P1

Google認証は成功したが、Alchemyのアカウント作成でエラーが発生。

> ⚠️ **アカウント作成に失敗しました**
> しばらく待ってから再度お試しください。
>
> [再試行] [MetaMaskでログイン]

代替手段（MetaMask）への誘導で完全にブロックされない。

---

### Journey 1c: ファン — 限定動画視聴「特別なコンテンツへのアクセス」

**ペルソナ: ユウキ（22歳）** — Journey 1と同一人物

**Opening Scene — 限定動画の発見**

ユウキはTechMaster Kenのチャンネルページを見ていると、「🔒 メンバー限定」というバッジがついた動画を発見する。

**Rising Action — アクセス条件の確認**

動画ページに遷移すると、プレーヤーの代わりにロック画面が表示される:

> 🔒 **この動画は限定公開です**
>
> 視聴条件: TechMaster Kenに0.05 ETH以上の投げ銭履歴がある
>
> あなたの状態: ❌ 条件を満たしていません
> 現在の投げ銭累計: 0.01 ETH
>
> [投げ銭して条件を満たす]

**Climax — 条件達成の瞬間**

ユウキは追加で0.04 ETHを投げ銭。トランザクション確認後、ページが自動更新:

> ✅ **視聴条件を満たしました！**

プレーヤーが表示され、ローディング画面が現れる:
> 🔓 **コンテンツを復号化しています...**
> あなたのウォレットで安全に視聴できるよう準備中です

数秒後、再生が始まる。

**Resolution — 特別な関係性**

限定動画を見終えたユウキは、他の限定動画もチェックし始める。「初期サポーター」としての自分の立場が、単なる視聴者以上のものになっていく。

---

### Journey 2: クリエイター — 「初日から報われる場所」

**ペルソナ: ケン（28歳）= TechMaster Ken**
本業はソフトウェアエンジニア。副業でテック系YouTube動画を投稿。登録者8,000人。YouTubeの収益化条件は満たしているが、収益は月数千円程度。Web3技術に興味があり、新しいプラットフォームを積極的に試す。

**Opening Scene — 新しいプラットフォームとの出会い**

ケンはTwitterで「分散型動画プラットフォーム」の話題を見かける。MetaMaskを持っているケンは、ウォレット接続を選択。数秒で接続完了。

**Rising Action — 初めての動画アップロード**

アップロードページで動画ファイルを選択。タイトル、説明、カテゴリを入力。

アップロードが始まると、進捗バーが表示される:
1. Preparing... ✓
2. Uploading... ✓
3. Transcoding... ✓
4. Storing... ✓
5. Complete!

数分後、自分の動画がプラットフォーム上で再生可能に。

**Climax — 最初の投げ銭を受け取る瞬間**

ケンはTwitterで告知を投稿。数時間後、通知が:

> 🎉 **ユウキさんから 0.01 ETH の投げ銭を受け取りました**

Polygonscanで確認すると、確かに自分のウォレットに0.01 ETHが入っている。プラットフォーム手数料ゼロ。

**ケンの心の声:** 「たった1人のファンでも、直接つながれるんだ。」

**Resolution — 新しい発信の形**

ケンはYouTubeと並行して、このプラットフォームを「コアなファン向けの場所」として運用し始める。

---

### Journey 2b: クリエイター — エラーリカバリー「やり直しの作法」

**ペルソナ: ケン（28歳）** — Journey 2と同一人物

**シナリオA: トランスコード失敗** ⚡ MVP必須

ケンが動画をアップロード。Transcodingで失敗。

> ❌ **トランスコードに失敗しました**
> 原因: 動画フォーマットがサポートされていません
> サポート形式: MP4 (H.264), WebM, MOV
>
> [別の形式で再アップロード]

**シナリオB: TUSリジューマブル再開** 📋 P1

大きな動画をアップロード中、進捗60%でネットワーク切断。再接続後:

> 📁 **前回のアップロードを再開できます**
> ファイル名: my-video.mp4 | 進捗: 60%
>
> [再開] [キャンセルして新規アップロード]

**シナリオC: Irys残高不足** ⚡ MVP必須

> ❌ **ストレージ残高が不足しています**
> 必要額: 0.002 ETH | Irys残高: 0.0005 ETH
>
> [残高を追加] [アップロードをキャンセル]

---

### Journey 3: コラボレーター — 「チームで作る、自動で分ける」（Phase 2）

**ペルソナ: サキ（25歳）**
インディーアニメーション作家。友人のミュージシャンとコラボして短編作品を制作。収益分配が課題。

> **Note:** このジャーニーはPhase 2（Revenue Split実装後）で実現予定。MVPスコープには含まれない。

Revenue Split機能により、動画アップロード時に「収益分配：サキ 60%、リョウ 40%」と設定。投げ銭が入るたびにスマートコントラクトが自動分配。

---

### Journey 4: プラットフォーム運営者 — 「持続可能性を確認する」

**ペルソナ: stanah（開発者 兼 運営者）**

**コスト監視フロー**

stanahは運用コストを計測・記録:

| 項目 | 実測値 |
|------|--------|
| Irysストレージ | $/GB |
| Livepeerトランスコード | $/分 |
| Lit復号 | $/リクエスト |
| Vercelホスティング | $/月 |
| ドメイン | $/年 |

**トラブルシューティングフロー**

障害発生時は以下のステータスページを確認:
- Lit Protocol: https://status.litprotocol.com/
- Livepeer: https://livepeer.statuspage.io/
- Irys: https://status.irys.xyz/

**シナリオ別対応:**

| 障害 | 確認方法 | 対応 |
|------|---------|------|
| Lit障害 | ブラウザコンソール + ステータスページ | 一時的→待機案内、長期→公開動画のみ継続 |
| Livepeer障害 | Studio Dashboard + API | 再試行案内、継続→サポート連絡 |
| Irys障害 | ネットワークタブ + ステータスページ | エンドポイント切替（環境変数化済み） |

---

### Journey Requirements Summary

| 優先度 | ジャーニー | 必要な機能・能力 | テスト |
|--------|-----------|-----------------|--------|
| ⚡ **MVP** | ファン — 成功パス | AAオンボーディング、動画視聴、投げ銭送信、トランザクション確認UI（10-30秒ローディング）、Polygonscanリンク | `e2e/fan-tipping-flow.spec.ts` |
| ⚡ **MVP** | ファン — 残高不足エラー | 残高不足エラー表示、追加方法への案内 | `e2e/fan-tipping-flow.spec.ts` に含む |
| ⚡ **MVP** | ファン — 限定動画視聴 | token-gatedロック画面、視聴条件表示、条件達成判定、Lit復号ローディング（理由表示付き） | `e2e/fan-tokengated-flow.spec.ts` |
| ⚡ **MVP** | クリエイター — 成功パス | MetaMask接続、動画アップロード、トランスコード進捗表示、投げ銭受領通知 | `e2e/creator-upload-flow.spec.ts` |
| ⚡ **MVP** | クリエイター — エラー表示 | フォーマットエラー表示、Irys残高不足エラー | `e2e/creator-upload-flow.spec.ts` に含む |
| 📋 **P1** | ファン — ネットワークエラー | ネットワークエラー表示・再試行ボタン | 手動テスト → P1で自動化 |
| 📋 **P1** | ファン — AAログイン失敗 | エラー表示、MetaMaskフォールバック | 手動テスト → P1で自動化 |
| 📋 **P1** | クリエイター — TUS再開 | リジューマブル再開UI | 手動テスト → P1で自動化 |
| 📋 **P2** | コラボレーター | Revenue Split設定UI、自動分配SC | Phase 2 |
| 📋 **P2** | 運営者 — ダッシュボード | コスト計測ダッシュボード | 手動記録で代替 |
| — | 運営者 — トラブルシューティング | ステータス確認リンク集（ドキュメント化） | 手動確認 |

## Domain-Specific Requirements

### Compliance & Regulatory

| 懸念事項 | PoC段階 | 本番移行時 | 備考 |
|---------|---------|-----------|------|
| **資金決済法（為替取引該当性）** | 対応不要（テストネット） | 並行調査必須 | ノンカストディアル設計により「為替取引」非該当の可能性あるが、法的確認が必要 |
| **暗号資産交換業該当性** | 対応不要 | 並行調査必須 | プラットフォームが暗号資産の売買・交換を仲介しない設計であることの確認 |
| **Revenue Splitの法的位置づけ** | Phase 2以降 | 要調査 | スマートコントラクトによる自動分配が「資金移動」に該当するか |
| **KYC/AML** | 対応不要 | 要検討 | ノンカストディアルP2P送金の場合の要否判断 |

### Technical Constraints

| 懸念事項 | PoC段階 | 本番移行時 |
|---------|---------|-----------|
| **ウォレットアドレスと個人情報の紐付け** | 記録のみ | プライバシーポリシー策定、AA経由の個人情報取扱い方針 |
| **スマートコントラクト監査** | 不要 | 第三者監査の実施 |
| **Lit ACCの信頼性** | 動作検証で十分 | アクセス制御の網羅的テスト |

### Platform Risks

| リスク | 影響 | PoC段階の対応 |
|--------|------|-------------|
| **コンテンツモデレーション困難** | Irys永続ストレージのため違法コンテンツ削除が困難 | 将来的懸念として記録。PoC段階は限定ユーザー運用 |
| **外部プロトコル可用性** | Lit / Livepeer / Irys障害時のサービス停止 | リスクとして記録。ステータスページ確認で対応 |

### PoC段階の方針

> **PoC段階ではドメイン固有の規制対応は行わない。** ただし、本番移行に向けて以下を並行で進める：
> 1. 資金決済法・暗号資産交換業への該当性調査（法務専門家への相談）
> 2. ノンカストディアル設計の法的根拠整理
> 3. コンテンツモデレーション方針の策定

## Innovation & Novel Patterns

### Detected Innovation Areas

**コアイノベーション: 分散型プロトコル統合アーキテクチャ（"薄い統合レイヤー"モデル）**

既存の動画プラットフォームが中央集権的にインフラを所有・運用するのに対し、本プロジェクトは各機能レイヤーを専門の分散型プロトコルに委ねる：

| レイヤー | 従来モデル | 本プロジェクト |
|---------|-----------|-------------|
| ストレージ | AWS S3 / GCP | Irys（永続分散ストレージ） |
| トランスコード | 自前 / AWS MediaConvert | Livepeer（分散トランスコード） |
| アクセス制御 | 自前DRM / Widevine | Lit Protocol（ACC） |
| 決済 | Stripe / 決済API | スマートコントラクト（P2P直接送金） |
| 認証 | OAuth / 自前 | AA（Account Abstraction） |

プラットフォーム自体は**統合レイヤーとフロントエンド**に徹し、インフラを所有しない。

### Market Context & Competitive Landscape

- **DTube / Odysee:** 独自ブロックチェーンベース。プロトコル統合ではなく自前インフラ
- **Theta Network:** 独自CDN + トークンエコノミクス。垂直統合型
- **本プロジェクト:** 既存の専門プロトコルを水平統合。各プロトコルの進化がそのまま恩恵になる

### Validation Approach

PoCで検証すべき仮説：

| 仮説 | 検証方法 | 成否判定 |
|------|---------|---------|
| 4プロトコル統合が技術的に成立する | E2Eパイプライン動作確認 | 公開・限定両パイプラインが一気通貫で動作 |
| 統合のレイテンシが実用的である | 限定動画初回再生時間計測 | 目標3秒以内 |
| 運用コストが中央集権モデルより有利 | 各プロトコルの実効コスト計測 | コスト内訳が記録され、比較可能 |
| Web2ライクなUXが実現可能 | AAオンボーディングフロー検証 | 3ステップ以内でログイン→視聴開始 |

> **Note:** イノベーションに伴うリスクと緩和策は「Project Scoping & Phased Development > Risk Mitigation Strategy」に統合。

## Blockchain & Web App Specific Requirements

### Project-Type Overview

Next.js 16（App Router）によるSPAベースのWeb3動画プラットフォーム。ブロックチェーン操作はPolygonネットワーク上のスマートコントラクトおよび各分散型プロトコルSDKを介して行う。

### Chain Specifications

| 項目 | PoC段階 | 本番移行時 |
|------|---------|-----------|
| **ネットワーク** | Polygon Amoy（テストネット） | 別途検討（Polygon PoS / zkEVM / 他チェーンを比較評価） |
| **ガス最適化** | 未対応 | チェーン選定と併せて検討（バッチ処理、ガスレスTx via AA等） |
| **コントラクト** | VideoTipping（P2P直接送金） | セキュリティ監査後に本番デプロイ |

**本番チェーン選定の検討観点:**
- ガスコスト（ユーザー負担の最小化）
- トランザクション確定速度（投げ銭UXに直結）
- エコシステムの成熟度（AA対応、SDK充実度）
- Lit Protocol / Irysとの互換性

### Wallet Support

| 接続方式 | 対象ユーザー | 実装 |
|---------|------------|------|
| **Account Abstraction** | 一般ユーザー（Web2ネイティブ） | Alchemy Account Kit（メール/SNSログイン） |
| **MetaMask** | Web3ネイティブユーザー | Viem直接接続 |

### Smart Contracts

| コントラクト | 機能 | フェーズ |
|-------------|------|---------|
| **VideoTipping** | P2P直接送金（投げ銭） | MVP |
| **Revenue Split** | 自動収益分配 | Phase 2 |

### Browser Matrix

| ブラウザ | バージョン | サポートレベル |
|---------|-----------|-------------|
| Chrome | 最新2バージョン | フルサポート |
| Firefox | 最新2バージョン | フルサポート |
| Safari | 最新2バージョン | フルサポート |
| Edge | 最新2バージョン | フルサポート |
| モバイルブラウザ | Chrome/Safari最新 | フルサポート |

### Real-time & Notification

| 機能 | フェーズ | 備考 |
|------|---------|------|
| **投げ銭受領通知** | MVP（基本） | ページ内通知。リアルタイムPush通知はP1 |
| **ライブストリーミング** | Phase 2 | 投げ銭との親和性が高く、収益最大化に直結 |
| **WebSocket/SSE** | P1 | リアルタイム通知基盤 |

### SEO Strategy

PoC段階ではSEO対応不要。動画のインデックシングやOGP対応はPost-MVPで検討。

### Accessibility

PoC段階では最低限の対応に留める：
- セマンティックHTML
- キーボードナビゲーション（主要操作）
- 十分なカラーコントラスト
- WCAG 2.1 AA準拠はPost-MVPで検討

### Implementation Considerations

- **スキップ項目:** `traditional_auth`（AA/MetaMaskで代替）、`centralized_db`（Irys + オンチェーンで代替）、`native_features`、`cli_commands`
- **フレームワーク:** Next.js 16 App Router + React 19 + TailwindCSS 4
- **状態管理:** React Context（WalletContext）+ hooks
- **Ethereum操作:** Viem

## Project Scoping & Phased Development

### MVP Strategy & Philosophy

**アプローチ: 技術実証型MVP（Problem-Solving MVP）**

「4つの分散型プロトコルの水平統合が、動画プラットフォームとして技術的に成立するか」を検証する。ユーザー獲得やグロースは目的としない。

**リソース:** ソロ開発者（stanah）
**前提条件:** Lit Protocol Naga移行完了（2026/2/25）

### MVP Implementation Strategy

P0-AとP0-Bを同時リリース。段階的な統合検証アプローチを採用：

```
Step 1: 個別プロトコル動作確認
  ├── Livepeer TUS アップロード + トランスコード 単体
  ├── Irys ストレージ 単体
  ├── Lit 暗号化/復号 単体
  └── VideoTipping コントラクト 単体

Step 2: ペアワイズ統合
  ├── Livepeer → Irys（トランスコード結果の保存）
  ├── Lit → Irys（暗号化データの保存・取得）
  └── AA → MetaMask（認証レイヤー統合）

Step 3: パイプライン統合
  ├── 公開動画: アップロード → トランスコード → 保存 → 再生
  └── 限定動画: 上記 + 暗号化 → ACC検証 → 復号 → 再生

Step 4: 全体統合
  └── 公開・限定動画 + 投げ銭 + AA の一気通貫テスト
```

**根拠:** 最大のリスクが「統合時の問題」であるため、早期にペアワイズ統合を行い、問題を小さく切り分けられるようにする。

### Scope Boundaries

| 含む（MVP） | 含まない（Post-MVP） | 理由 |
|------------|-------------------|------|
| 公開動画パイプライン | HLSアダプティブビットレート | コア検証に不要 |
| 限定動画パイプライン | ライブストリーミング | Phase 2 |
| 投げ銭（P2P直接送金） | Revenue Split | Phase 2 |
| AA オンボーディング | リアルタイムPush通知 | P1 |
| Playwright E2Eテスト | CI/CD自動化 | P1 |
| ページ内投げ銭通知（基本） | WebSocket/SSE通知基盤 | P1 |

### Risk Mitigation Strategy

**最大リスク: プロトコル間統合の不確実性**

| リスク | 影響度 | 発生確率 | 緩和策 |
|--------|-------|---------|--------|
| **統合時の予期しない相互作用** | 高 | 高 | ペアワイズ統合で早期検出。各統合ポイントにE2Eテスト配置 |
| **Lit Naga移行の遅延/非互換** | 高 | 中 | 2/25期限。DatilDevで先行開発し、Naga移行は最小差分で |
| **ソロ開発者のバス係数** | 高 | — | ドキュメント整備（PRD, アーキテクチャ文書）。コード品質維持 |
| **スコープクリープ** | 中 | 高 | MVP境界を厳守。「あると嬉しい」はP1以降に厳格に先送り |
| **プロトコルのAPI破壊的変更** | 中 | 低 | SDK抽象化層。バージョン固定 |

**リソースリスク（ソロ開発）への対応:**
- MVP機能を最小限に厳守（既にProduct Scopeで定義済み）
- P0-A（公開動画）を先に安定させてからP0-B統合に進む実装順序
- 完璧を目指さない。「動く」ことが最優先

## Functional Requirements

### ユーザー認証・オンボーディング

- **FR1:** 一般ユーザーはメールまたはSNSアカウントでログインできる
- **FR2:** Web3ユーザーはMetaMaskウォレットで接続できる
- **FR3:** ユーザーは3ステップ以内でオンボーディングを完了し、動画視聴を開始できる
- **FR4:** ユーザーは自分のプロフィール情報（ウォレットアドレス等）を確認できる
- **FR5:** AAログイン失敗時、ユーザーはMetaMaskでのログインに切り替えられる
- **FR6:** ユーザーはログアウトできる

### 動画管理

- **FR7:** クリエイターは動画ファイルをアップロードできる
- **FR8:** クリエイターは動画のメタデータ（タイトル、説明、カテゴリ、アクセスタイプ）を設定できる
- **FR9:** クリエイターはアップロード・トランスコードの進捗状況を確認できる
- **FR10:** クリエイターは動画を「公開」または「限定」として公開できる
- **FR11:** システムはアップロードされた動画を自動的にトランスコードし、ストリーミング形式で保存する
- **FR12:** システムは限定動画をアクセス制御条件付きで暗号化して保存する
- **FR13:** トランスコード失敗時、クリエイターはサポート形式の案内とともにエラーを確認できる
- **FR14:** ストレージ残高不足時、クリエイターはエラーと残高追加方法を確認できる
- **FR15:** クリエイターは自分がアップロードした動画の一覧を確認できる
- **FR16:** クリエイターはIrysストレージに資金をデポジットできる

### 動画再生

- **FR17:** ユーザーは公開動画をログイン不要で視聴できる
- **FR18:** 条件を満たすユーザーは限定動画を視聴できる
- **FR19:** 限定動画の復号処理中、ユーザーは進捗と理由の表示を確認できる
- **FR20:** ユーザーは動画の詳細情報（タイトル、説明、クリエイター情報）を閲覧できる

### 投げ銭

- **FR21:** ファンはクリエイターに対して投げ銭を送信できる
- **FR22:** ファンは投げ銭額をプリセットから選択できる
- **FR23:** ファンは投げ銭送信後、オンチェーンでの到達確認を表示で確認できる
- **FR24:** ファンはトランザクションの詳細をブロックチェーンエクスプローラーで確認できる
- **FR25:** クリエイターは投げ銭の受領通知を受け取ることができる
- **FR26:** 残高不足時、ファンはエラー表示と残高追加方法の案内を確認できる

### コンテンツアクセス制御

- **FR27:** 限定動画へのアクセス時、条件を満たさないユーザーにはロック画面が表示される
- **FR28:** ロック画面にはアクセス条件と現在の充足状況が表示される
- **FR29:** ユーザーが条件を満たした場合、自動的にアクセスが許可される
- **FR30:** 送信者と受信者の両方が、暗号化されたコンテンツを復号できる

### コンテンツ発見

- **FR31:** ユーザーはプラットフォーム上の動画一覧を閲覧できる
- **FR32:** ユーザーはタグやカテゴリで動画をフィルタリングできる
- **FR33:** ユーザーは動画の公開/限定の区別を一覧上で識別できる
- **FR34:** ユーザーはクリエイター別に動画を絞り込むことができる
- **FR35:** ユーザーは自分のウォレット残高を確認できる

### 運用・コスト監視

- **FR36:** 運営者は各プロトコル（Irys, Livepeer, Lit）の実効コストを記録・参照できる
- **FR37:** 運営者は外部プロトコルのステータスページへのリンクを参照できる
- **FR38:** 主要パイプライン（公開動画、限定動画、投げ銭、AA）のE2Eテストが自動実行できる

## Non-Functional Requirements

### Performance

| NFR | 基準 | 計測方法 |
|-----|------|---------|
| **NFR-P1:** 公開動画の再生開始時間 | 1秒以内（ブロードバンド接続 下り10Mbps以上環境で計測） | HLS初回セグメント読み込み完了まで |
| **NFR-P2:** 限定動画の再生開始時間（復号含む） | 3秒以内（ブロードバンド接続 下り10Mbps以上環境で計測） | ACC検証→復号→初回セグメント再生まで |
| **NFR-P3:** ページ初期ロード時間 | 3秒以内（LCP） | Lighthouse計測 |
| **NFR-P4:** 投げ銭トランザクション確認表示 | 送信→確認表示までの時間を計測・記録。計測結果がログまたはUIで確認可能であること | チェーン依存のため目標値はPoC後に設定 |
| **NFR-P5:** 動画アップロード→公開までの所要時間 | 計測・記録（トランスコード時間含む）。計測結果がログまたはUIで確認可能であること | 動画長・解像度別に記録 |

### Security

| NFR | 基準 | 備考 |
|-----|------|------|
| **NFR-S1:** ウォレット秘密鍵はサーバー側に送信・保存しない | 必須 | クライアントサイド署名のみ |
| **NFR-S2:** 限定コンテンツはACC条件を満たすウォレットのみ復号可能 | 必須 | Lit Protocol ACC検証 |
| **NFR-S3:** スマートコントラクトは意図した送金先以外に資金を送らない | 必須 | コントラクトテストで検証 |
| **NFR-S4:** API通信はすべてHTTPS経由 | 必須 | 外部プロトコルAPI含む |
| **NFR-S5:** サーバーサイド専用の秘密情報が`NEXT_PUBLIC_`プレフィックスで公開されない | 必須 | `NEXT_PUBLIC_`付きの変数はクライアントに公開されるため、サーバー専用キーには使用しない |
| **NFR-S6:** Lit認証セッション（Session Signatures）はサーバー側に保存しない | 必須 | クライアントサイドのみで管理 |

### Integration

| NFR | 基準 | 備考 |
|-----|------|------|
| **NFR-I1:** 各プロトコルSDKのバージョンを固定する | 必須 | package.jsonで明示的バージョン指定 |
| **NFR-I2:** Lit Protocol障害時、公開動画の視聴は影響を受けない | 必須 | 公開動画パイプラインはLit非依存 |
| **NFR-I3:** 外部プロトコルAPIのレスポンスタイムアウトをプロトコル別に設定する | Lit: 60秒、Livepeer: 30秒、Irys: 15秒 | Lit復号はNaga移行直後の不安定性を考慮 |
| **NFR-I4:** Irys GraphQLエンドポイントは環境変数で設定可能 | 必須 | L1移行等のエンドポイント変更に備える |
| **NFR-I5:** 外部プロトコルのエラーはユーザーに理解可能な形で表示する | 必須 | 内部エラーコードをユーザー向けメッセージに変換 |
| **NFR-I6:** Livepeer障害時、Irysに保存済みの動画の再生は影響を受けない | 必須 | 新規アップロードは不可だが既存動画は再生可能 |

### Reliability

| NFR | 基準 | 備考 |
|-----|------|------|
| **NFR-R1:** 単一プロトコル障害時、他の機能は正常に動作する | 必須 | グレースフルデグラデーション |
| **NFR-R2:** トランザクション送信後のネットワーク切断時、ユーザーに状態を明示する | 必須 | 「送信済み/未確認」の状態表示 |
| **NFR-R3:** E2Eテストで主要4パイプラインの正常動作を継続的に検証する | 必須 | Playwright自動テスト |
